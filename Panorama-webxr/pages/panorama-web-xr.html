<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
		<title>Dual Cylinder Projection</title>
		<link type="text/css" rel="stylesheet" href="main.css" />
	</head>
	<body>
		<!-- <script src="../../THREE116/examples/js/HelioWebXRPolyfill.js"></script> -->
		<script type="module">
			// three.js revision 116
			// 启用webXR的几个步骤
			// 1. import VRButton
			// 2. document.body.appendChild( VRButton.createButton( renderer ) )
			// 3. renderer.xr.enabled = true
			// 4. 使用serAnimationLoop 代替 window.requestAnimationFrame
			
			import * as THREE from '../../THREE116/build/three.module.js';
			import {VRButton} from '../../THREE116/examples/jsm/webxr/VRButton.js';
			import {OBJLoader} from '../../THREE116/examples/jsm/loaders/OBJLoader.js';
			
			var camera, renderer, scene;
			
			
			init();
			
			animate();

			function init() {
				renderer = new THREE.WebGLRenderer();
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.xr.enabled = true;
				renderer.xr.setReferenceSpaceType( 'local' );
				document.body.appendChild( renderer.domElement );

				document.body.appendChild( VRButton.createButton( renderer ) );

				//

				scene = new THREE.Scene();

				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000 );
				camera.layers.enable( 1 );
				
				
				// material
				var materialL, materialR;
				
				var textureLoader = new THREE.TextureLoader();
				textureLoader.load('../resources/textures/Map1_L.jpg',function(texture){
					materialL = new THREE.MeshBasicMaterial({map:texture});
				});
				textureLoader.load('../resources/textures/Map1_R.jpg',function(texture){
					materialR = new THREE.MeshBasicMaterial({map:texture});
				});
				
				
				// model
				var meshL, meshR;
				var loader = new OBJLoader();

				loader.load('../resources/models/dualcylinder.obj',function(obj){
					meshL = obj.children[0].clone();
					meshR = obj.children[0].clone();
					
					meshL.material = materialL;
					meshR.material = materialR;
					
					meshL.layers.set(1);
					meshR.layers.set(2);
					
					scene.add(meshL);
					scene.add(meshR);
					
					//console.log(scene);
				});

				window.addEventListener( 'resize', onWindowResize, false );

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function animate() {

				renderer.setAnimationLoop( render );

			}

			function render() {

				renderer.render( scene, camera );

			}
		</script>
	</body>
</html>
